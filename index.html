<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üé∞ Super Bowl LX Draft Machine</title>
  
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#1a0a2e">
  <meta name="mobile-web-app-capable" content="yes">
  <link rel="apple-touch-icon" href="icons/icon-192.png">
  
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Oswald:wght@400;500;600;700&display=swap');
    
    :root {
      --bg-dark: #0a0a12;
      --gold: #ffd700;
      --gold-dim: #b8960b;
      --neon-pink: #ff00ff;
      --neon-blue: #00ffff;
      --afc-red: #c41e3a;
      --afc-red-dark: #8b0000;
      --nfc-blue: #1e56a0;
      --nfc-blue-dark: #0a2351;
      --text: #ffffff;
      --text-muted: #8a8a9a;
    }
    
    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    body {
      font-family: 'Oswald', sans-serif;
      background: var(--bg-dark);
      background-image: radial-gradient(ellipse at top, #1a0a2e 0%, transparent 50%),
                        radial-gradient(ellipse at bottom, #0a1a2e 0%, transparent 50%);
      color: var(--text);
      min-height: 100vh;
    }
    
    .header {
      text-align: center;
      padding: 20px;
    }
    
    .header h1 {
      font-size: 2.5rem;
      font-weight: 700;
      color: var(--gold);
      text-shadow: 0 0 10px var(--gold), 0 0 20px var(--gold), 0 0 40px var(--gold-dim);
      animation: glow 2s ease-in-out infinite alternate;
    }
    
    @keyframes glow {
      from { text-shadow: 0 0 10px var(--gold), 0 0 20px var(--gold), 0 0 40px var(--gold-dim); }
      to { text-shadow: 0 0 20px var(--gold), 0 0 40px var(--gold), 0 0 60px var(--gold-dim); }
    }
    
    .header p {
      color: var(--neon-pink);
      font-size: 1rem;
      margin-top: 8px;
      text-shadow: 0 0 10px var(--neon-pink);
    }
    
    .container { max-width: 900px; margin: 0 auto; padding: 20px; }
    
    .current-player {
      text-align: center;
      margin-bottom: 24px;
      padding: 16px;
      background: linear-gradient(135deg, rgba(255,215,0,0.1), rgba(255,215,0,0.05));
      border: 2px solid var(--gold);
      border-radius: 16px;
      box-shadow: 0 0 20px rgba(255,215,0,0.2);
    }
    
    .current-player-label {
      font-size: 0.9rem;
      color: var(--gold);
      text-transform: uppercase;
      letter-spacing: 2px;
    }
    
    .current-player-name {
      font-size: 2rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      margin-top: 8px;
    }
    
    .current-player-name img {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      border: 3px solid var(--gold);
    }
    
    .slot-machine {
      background: linear-gradient(180deg, #2a2a4a 0%, #1a1a2e 50%, #2a2a4a 100%);
      border-radius: 24px;
      padding: 24px;
      border: 4px solid #444;
      box-shadow: inset 0 0 50px rgba(0,0,0,0.5), 0 0 30px rgba(0,0,0,0.5);
      position: relative;
    }
    
    .slot-machine::before {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--neon-pink), var(--neon-blue), var(--neon-pink));
      animation: borderGlow 3s linear infinite;
    }
    
    @keyframes borderGlow { 0%, 100% { opacity: 0.5; } 50% { opacity: 1; } }
    
    .lights {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin-bottom: 16px;
    }
    
    .light {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      animation: lightBlink 1s infinite;
    }
    
    .light:nth-child(odd) {
      background: var(--neon-pink);
      box-shadow: 0 0 10px var(--neon-pink);
    }
    
    .light:nth-child(even) {
      background: var(--neon-blue);
      box-shadow: 0 0 10px var(--neon-blue);
      animation-delay: 0.5s;
    }
    
    @keyframes lightBlink { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }
    
    .reels-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 24px;
      margin-bottom: 24px;
    }
    
    @media (max-width: 600px) {
      .reels-container { grid-template-columns: 1fr; gap: 16px; }
    }
    
    .reel-wrapper {
      background: linear-gradient(180deg, #0a0a15, #15152a, #0a0a15);
      border-radius: 16px;
      padding: 16px;
      border: 3px solid #333;
    }
    
    .reel-wrapper.afc { border-color: var(--afc-red); box-shadow: 0 0 20px rgba(196,30,58,0.3); }
    .reel-wrapper.nfc { border-color: var(--nfc-blue); box-shadow: 0 0 20px rgba(30,86,160,0.3); }
    .reel-wrapper.spinning { animation: machineShake 0.1s infinite; }
    .reel-wrapper.winner { animation: winnerPulse 0.5s ease-in-out 3; }
    
    @keyframes machineShake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-2px); } 75% { transform: translateX(2px); } }
    @keyframes winnerPulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.02); } }
    
    .reel-label {
      text-align: center;
      font-size: 1.5rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 3px;
      margin-bottom: 12px;
      padding: 8px;
      border-radius: 8px;
    }
    
    .reel-label.afc { background: linear-gradient(135deg, var(--afc-red), var(--afc-red-dark)); }
    .reel-label.nfc { background: linear-gradient(135deg, var(--nfc-blue), var(--nfc-blue-dark)); }
    
    .reel-window {
      height: 180px;
      background: linear-gradient(180deg, #000 0%, #1a1a2a 10%, #1a1a2a 90%, #000 100%);
      border-radius: 12px;
      overflow: hidden;
      position: relative;
      border: 2px solid #222;
    }
    
    .reel-window::after {
      content: '';
      position: absolute;
      top: 50%; left: 0; right: 0;
      height: 2px;
      background: var(--gold);
      box-shadow: 0 0 10px var(--gold);
      transform: translateY(-50%);
      z-index: 11;
      opacity: 0.5;
    }
    
    .reel-strip {
      display: flex;
      flex-direction: column;
    }
    
    .reel-team {
      height: 180px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 16px;
      flex-shrink: 0;
    }
    
    .reel-team img {
      width: 80px;
      height: 80px;
      object-fit: contain;
      filter: drop-shadow(0 0 10px rgba(255,255,255,0.3));
    }
    
    .reel-team span {
      font-size: 1.2rem;
      font-weight: 600;
      margin-top: 12px;
      text-align: center;
      text-shadow: 0 2px 4px rgba(0,0,0,0.5);
    }
    
    .spin-buttons {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 24px;
    }
    
    @media (max-width: 600px) { .spin-buttons { grid-template-columns: 1fr; gap: 12px; } }
    
    .spin-btn {
      padding: 20px 32px;
      border: none;
      border-radius: 16px;
      font-family: 'Oswald', sans-serif;
      font-size: 1.4rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 2px;
      cursor: pointer;
      transition: all 0.2s;
      position: relative;
      overflow: hidden;
    }
    
    .spin-btn.afc {
      background: linear-gradient(135deg, var(--afc-red), var(--afc-red-dark));
      color: white;
      box-shadow: 0 4px 20px rgba(196,30,58,0.4);
    }
    
    .spin-btn.nfc {
      background: linear-gradient(135deg, var(--nfc-blue), var(--nfc-blue-dark));
      color: white;
      box-shadow: 0 4px 20px rgba(30,86,160,0.4);
    }
    
    .spin-btn:hover:not(:disabled) { transform: translateY(-3px); }
    .spin-btn:disabled { opacity: 0.4; cursor: not-allowed; transform: none !important; }
    .spin-btn.picked { background: #333; box-shadow: none; }
    
    .next-player-btn {
      display: none;
      width: 100%;
      padding: 20px;
      margin-top: 16px;
      border: none;
      border-radius: 16px;
      background: linear-gradient(135deg, var(--gold), var(--gold-dim));
      color: #000;
      font-family: 'Oswald', sans-serif;
      font-size: 1.3rem;
      font-weight: 700;
      text-transform: uppercase;
      cursor: pointer;
    }
    
    .next-player-btn.show { display: block; }
    .next-player-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 30px rgba(255,215,0,0.4); }
    
    .winner-display {
      display: none;
      text-align: center;
      padding: 24px;
      margin-top: 24px;
      background: linear-gradient(135deg, rgba(255,215,0,0.2), rgba(255,215,0,0.1));
      border: 3px solid var(--gold);
      border-radius: 16px;
      animation: winnerAppear 0.5s ease;
    }
    
    .winner-display.show { display: block; }
    
    @keyframes winnerAppear { 0% { transform: scale(0.8); opacity: 0; } 50% { transform: scale(1.05); } 100% { transform: scale(1); opacity: 1; } }
    
    .winner-display h3 { font-size: 1.5rem; color: var(--gold); text-shadow: 0 0 20px var(--gold); }
    
    .winner-team {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 16px;
      margin-top: 12px;
    }
    
    .winner-team img { width: 64px; height: 64px; object-fit: contain; }
    .winner-team span { font-size: 2rem; font-weight: 700; }
    
    .draft-board {
      background: #12121a;
      border: 2px solid #333;
      border-radius: 16px;
      padding: 20px;
      margin-top: 24px;
    }
    
    .draft-board h2 {
      font-size: 1.3rem;
      color: var(--gold);
      margin-bottom: 16px;
      text-align: center;
    }
    
    .draft-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 12px;
    }
    
    .draft-card {
      background: linear-gradient(135deg, #1a1a24, #12121a);
      border: 1px solid #333;
      border-radius: 12px;
      padding: 12px;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .draft-card.current { border-color: var(--gold); box-shadow: 0 0 20px rgba(255,215,0,0.2); }
    .draft-card.completed { opacity: 0.6; }
    
    .draft-card-avatar {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid #444;
    }
    
    .draft-card.current .draft-card-avatar { border-color: var(--gold); }
    
    .draft-card-info { flex: 1; }
    .draft-card-name { font-size: 1.1rem; font-weight: 600; }
    
    .draft-card-picks { display: flex; gap: 8px; margin-top: 6px; }
    
    .draft-pick {
      display: flex;
      align-items: center;
      gap: 4px;
      font-size: 0.75rem;
      padding: 4px 8px;
      border-radius: 8px;
      background: rgba(0,0,0,0.3);
    }
    
    .draft-pick img { width: 18px; height: 18px; object-fit: contain; }
    .draft-pick.afc { border: 1px solid var(--afc-red); }
    .draft-pick.nfc { border: 1px solid var(--nfc-blue); }
    .draft-pick.pending { color: var(--text-muted); font-style: italic; }
    
    .draft-complete {
      display: none;
      text-align: center;
      padding: 40px;
      background: linear-gradient(135deg, rgba(255,215,0,0.15), rgba(255,215,0,0.05));
      border: 3px solid var(--gold);
      border-radius: 16px;
      margin-bottom: 24px;
    }
    
    .draft-complete.show { display: block; }
    .draft-complete h2 { font-size: 2.5rem; color: var(--gold); text-shadow: 0 0 30px var(--gold); margin-bottom: 16px; }
    .draft-complete p { color: var(--text-muted); margin-bottom: 20px; }
    
    .export-btn {
      padding: 12px 24px;
      border: none;
      border-radius: 12px;
      background: linear-gradient(135deg, #2ecc71, #27ae60);
      color: white;
      font-family: 'Oswald', sans-serif;
      font-size: 1rem;
      font-weight: 600;
      text-transform: uppercase;
      cursor: pointer;
      margin: 4px;
    }
    
    .export-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 20px rgba(46,204,113,0.4); }
    
    .loading-overlay {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.9);
      z-index: 100;
      align-items: center;
      justify-content: center;
      flex-direction: column;
    }
    
    .loading-overlay.show { display: flex; }
    
    .loading-spinner {
      width: 60px;
      height: 60px;
      border: 4px solid #333;
      border-top-color: var(--gold);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }
    
    @keyframes spin { to { transform: rotate(360deg); } }
    
    .loading-text { margin-top: 16px; color: var(--gold); font-size: 1.2rem; }
    
    .mode-toggle { display: flex; justify-content: center; gap: 12px; margin-bottom: 20px; }
    
    .mode-btn {
      padding: 10px 20px;
      border: 2px solid #444;
      border-radius: 10px;
      background: transparent;
      color: var(--text-muted);
      font-family: 'Oswald', sans-serif;
      font-size: 0.9rem;
      cursor: pointer;
    }
    
    .mode-btn:hover { border-color: var(--gold); color: var(--gold); }
    .mode-btn.active { background: var(--gold); border-color: var(--gold); color: #000; }
  </style>
</head>
<body>
  <div class="loading-overlay" id="loadingOverlay">
    <div class="loading-spinner"></div>
    <p class="loading-text">Loading Draft Machine...</p>
  </div>

  <header class="header">
    <h1>üé∞ Super Bowl LX Draft üé∞</h1>
    <p>Pull the lever, win your team!</p>
  </header>

  <main class="container">
    <div class="mode-toggle">
      <button class="mode-btn active" id="liveModeBtn" onclick="setMode('live')">üéØ Live Draft</button>
      <button class="mode-btn" id="replayModeBtn" onclick="setMode('replay')">üìã View Results</button>
    </div>

    <div id="liveDraftSection">
      <div class="current-player" id="currentPlayer">
        <div class="current-player-label">Now Drafting</div>
        <div class="current-player-name">
          <img src="" alt="" id="currentPlayerAvatar">
          <span id="currentPlayerText">Loading...</span>
        </div>
      </div>

      <div class="slot-machine" id="slotMachine">
        <div class="lights">
          <div class="light"></div><div class="light"></div><div class="light"></div>
          <div class="light"></div><div class="light"></div><div class="light"></div>
          <div class="light"></div><div class="light"></div><div class="light"></div>
        </div>

        <div class="reels-container">
          <div class="reel-wrapper afc" id="afcReelWrapper">
            <div class="reel-label afc">AFC</div>
            <div class="reel-window">
              <div class="reel-strip" id="afcReel"></div>
            </div>
          </div>
          <div class="reel-wrapper nfc" id="nfcReelWrapper">
            <div class="reel-label nfc">NFC</div>
            <div class="reel-window">
              <div class="reel-strip" id="nfcReel"></div>
            </div>
          </div>
        </div>

        <div class="spin-buttons">
          <button class="spin-btn afc" id="afcSpinBtn" onclick="spinReel('afc')">üé∞ Spin AFC</button>
          <button class="spin-btn nfc" id="nfcSpinBtn" onclick="spinReel('nfc')">üé∞ Spin NFC</button>
        </div>

        <button class="next-player-btn" id="nextPlayerBtn" onclick="nextPlayer()">‚û°Ô∏è Next Player</button>
      </div>

      <div class="winner-display" id="winnerDisplay">
        <h3 id="winnerTitle">üéâ Winner!</h3>
        <div class="winner-team" id="winnerTeam"></div>
      </div>

      <div class="draft-complete" id="draftComplete">
        <h2>üèÜ Draft Complete! üèÜ</h2>
        <p>All teams have been assigned. Good luck in the playoffs!</p>
        <button class="export-btn" onclick="exportResults()">üìã Copy Results</button>
        <button class="export-btn" onclick="exportToPicksJson()">üíæ Export picks.json</button>
      </div>
    </div>

    <div id="resultsSection" style="display: none;">
      <div class="draft-complete show">
        <h2>üìã Draft Results</h2>
        <p>Here's how the draft played out!</p>
        <button class="export-btn" onclick="exportResults()">üìã Copy Results</button>
      </div>
    </div>

    <div class="draft-board">
      <h2>üìã Draft Board</h2>
      <div class="draft-grid" id="draftGrid"></div>
    </div>
  </main>

  <script>
    const CONFIG = {
      JSONBIN_BIN_ID: '695b078fd0ea881f4054b2a0',
      JSONBIN_API_KEY: '$2a$10$C7BY0Kl0u74gNn/kXO7xNuayWv493/f1jAxlHUmx3ENADQKDii61C',
      DRAFT_ORDER: ['joe', 'jarv', 'matt', 'mark', 'gaz', 'liam', 'ben'],
      PLAYERS: {
        joe:  { name: 'Joe',  avatar: 'Assets/joe.png' },
        jarv: { name: 'Jarv', avatar: 'Assets/jarv.png' },
        matt: { name: 'Matt', avatar: 'Assets/matt.png' },
        mark: { name: 'Mark', avatar: 'Assets/mark.png' },
        gaz:  { name: 'Gaz',  avatar: 'Assets/gaz.png' },
        liam: { name: 'Liam', avatar: 'Assets/liam.png' },
        ben:  { name: 'Ben',  avatar: 'Assets/ben.png' }
      },
      AFC_TEAMS: [],
      NFC_TEAMS: []
    };

    let state = {
      mode: 'live',
      currentPlayerIndex: 0,
      availableAFC: [],
      availableNFC: [],
      picks: {},
      currentPicks: { afc: null, nfc: null },
      isSpinning: false,
      draftComplete: false,
      replayData: []
    };

    async function fetchPlayoffTeams() {
      try {
        const response = await fetch('https://site.api.espn.com/apis/v2/sports/football/nfl/standings?season=2025&type=3');
        if (!response.ok) throw new Error('ESPN fetch failed');
        const data = await response.json();
        const afcTeams = [], nfcTeams = [];
        
        data.children?.forEach(conference => {
          const isAFC = conference.name.includes('American');
          conference.children?.forEach(division => {
            division.standings?.entries?.forEach(entry => {
              const team = entry.team;
              const playoffSeed = entry.stats?.find(s => s.name === 'playoffSeed')?.value;
              if (playoffSeed && playoffSeed <= 7) {
                const teamData = {
                  name: team.displayName,
                  short: team.shortDisplayName || team.abbreviation,
                  logo: team.logos?.[0]?.href || `https://a.espncdn.com/i/teamlogos/nfl/500/${team.abbreviation.toLowerCase()}.png`,
                  seed: playoffSeed
                };
                (isAFC ? afcTeams : nfcTeams).push(teamData);
              }
            });
          });
        });
        
        afcTeams.sort((a, b) => a.seed - b.seed);
        nfcTeams.sort((a, b) => a.seed - b.seed);
        CONFIG.AFC_TEAMS = afcTeams.slice(0, 7);
        CONFIG.NFC_TEAMS = nfcTeams.slice(0, 7);
        
        if (CONFIG.AFC_TEAMS.length === 0 || CONFIG.NFC_TEAMS.length === 0) throw new Error('No playoff teams');
      } catch (err) {
        console.log('Using fallback teams:', err.message);
        CONFIG.AFC_TEAMS = [
          { name: 'Denver Broncos', short: 'Broncos', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/den.png', seed: 1 },
          { name: 'New England Patriots', short: 'Patriots', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/ne.png', seed: 2 },
          { name: 'Jacksonville Jaguars', short: 'Jaguars', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/jax.png', seed: 3 },
          { name: 'Pittsburgh Steelers', short: 'Steelers', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/pit.png', seed: 4 },
          { name: 'Houston Texans', short: 'Texans', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/hou.png', seed: 5 },
          { name: 'Buffalo Bills', short: 'Bills', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/buf.png', seed: 6 },
          { name: 'Los Angeles Chargers', short: 'Chargers', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/lac.png', seed: 7 }
        ];
        CONFIG.NFC_TEAMS = [
          { name: 'Seattle Seahawks', short: 'Seahawks', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/sea.png', seed: 1 },
          { name: 'Chicago Bears', short: 'Bears', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/chi.png', seed: 2 },
          { name: 'Philadelphia Eagles', short: 'Eagles', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/phi.png', seed: 3 },
          { name: 'Carolina Panthers', short: 'Panthers', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/car.png', seed: 4 },
          { name: 'Los Angeles Rams', short: 'Rams', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/lar.png', seed: 5 },
          { name: 'San Francisco 49ers', short: '49ers', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/sf.png', seed: 6 },
          { name: 'Green Bay Packers', short: 'Packers', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/gb.png', seed: 7 }
        ];
      }
    }

    async function init() {
      showLoading(true);
      await fetchPlayoffTeams();
      state.availableAFC = [...CONFIG.AFC_TEAMS];
      state.availableNFC = [...CONFIG.NFC_TEAMS];
      CONFIG.DRAFT_ORDER.forEach(id => { state.picks[id] = { afcTeam: null, nfcTeam: null }; });
      await loadDraftData();
      renderReels();
      renderDraftBoard();
      updateUI();
      showLoading(false);
    }

    async function loadDraftData() {
      try {
        const response = await fetch(`https://api.jsonbin.io/v3/b/${CONFIG.JSONBIN_BIN_ID}/latest`, {
          headers: { 'X-Access-Key': CONFIG.JSONBIN_API_KEY }
        });
        if (response.ok) {
          const data = await response.json();
          const record = data.record;
          if (record?.picks) {
            CONFIG.DRAFT_ORDER.forEach(id => { if (record.picks[id]) state.picks[id] = record.picks[id]; });
            state.replayData = record.replayData || [];
            state.draftComplete = record.draftComplete || false;
            reconstructAvailableTeams();
            findCurrentPosition();
          }
        }
      } catch (err) { console.log('No existing draft data:', err); }
    }

    async function saveDraftData() {
      try {
        await fetch(`https://api.jsonbin.io/v3/b/${CONFIG.JSONBIN_BIN_ID}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json', 'X-Access-Key': CONFIG.JSONBIN_API_KEY },
          body: JSON.stringify({
            picks: state.picks,
            replayData: state.replayData,
            draftStarted: true,
            draftComplete: state.draftComplete,
            lastUpdated: new Date().toISOString()
          })
        });
      } catch (err) { console.error('Error saving:', err); }
    }

    function reconstructAvailableTeams() {
      state.availableAFC = [...CONFIG.AFC_TEAMS];
      state.availableNFC = [...CONFIG.NFC_TEAMS];
      Object.values(state.picks).forEach(pick => {
        if (pick.afcTeam) state.availableAFC = state.availableAFC.filter(t => t.name !== pick.afcTeam);
        if (pick.nfcTeam) state.availableNFC = state.availableNFC.filter(t => t.name !== pick.nfcTeam);
      });
    }

    function findCurrentPosition() {
      for (let i = 0; i < CONFIG.DRAFT_ORDER.length; i++) {
        const pick = state.picks[CONFIG.DRAFT_ORDER[i]];
        if (!pick.afcTeam || !pick.nfcTeam) {
          state.currentPlayerIndex = i;
          state.currentPicks = { afc: pick.afcTeam, nfc: pick.nfcTeam };
          return;
        }
      }
      state.draftComplete = true;
    }

    function renderReels() {
      renderReel('afc');
      renderReel('nfc');
    }

    function renderReel(conf) {
      const reel = document.getElementById(`${conf}Reel`);
      const teams = conf === 'afc' ? state.availableAFC : state.availableNFC;
      if (teams.length === 0) { reel.innerHTML = '<div class="reel-team"><span>No teams left</span></div>'; return; }
      let html = '';
      for (let c = 0; c < 4; c++) {
        teams.forEach(t => {
          html += `<div class="reel-team" data-team="${t.name}"><img src="${t.logo}" alt="${t.short}"><span>${t.short}</span></div>`;
        });
      }
      reel.innerHTML = html;
      reel.style.transform = 'translateY(0px)';
    }

    function spinReel(conf) {
      if (state.isSpinning || state.draftComplete || state.currentPicks[conf]) return;
      state.isSpinning = true;
      
      const reel = document.getElementById(`${conf}Reel`);
      const wrapper = document.getElementById(`${conf}ReelWrapper`);
      const btn = document.getElementById(`${conf}SpinBtn`);
      const teams = conf === 'afc' ? state.availableAFC : state.availableNFC;
      
      btn.disabled = true;
      document.getElementById('afcSpinBtn').disabled = true;
      document.getElementById('nfcSpinBtn').disabled = true;
      wrapper.classList.add('spinning');
      
      const winnerIndex = Math.floor(Math.random() * teams.length);
      const winner = teams[winnerIndex];
      const itemHeight = 180;
      const totalItems = teams.length;
      const spinCycles = 3;
      const finalPosition = (spinCycles * totalItems + winnerIndex) * itemHeight;
      const spinDuration = 3500;
      const startTime = Date.now();
      
      function animateSpin() {
        const elapsed = Date.now() - startTime;
        const progress = Math.min(elapsed / spinDuration, 1);
        const easeOut = 1 - Math.pow(1 - progress, 3);
        const currentPos = finalPosition * easeOut;
        const wrappedPos = currentPos % (totalItems * itemHeight * 4);
        reel.style.transform = `translateY(-${wrappedPos}px)`;
        if (progress < 1) requestAnimationFrame(animateSpin);
        else finishSpin(conf, winner, wrapper, btn);
      }
      requestAnimationFrame(animateSpin);
    }

    function finishSpin(conf, winner, wrapper, btn) {
      wrapper.classList.remove('spinning');
      wrapper.classList.add('winner');
      setTimeout(() => wrapper.classList.remove('winner'), 1500);
      
      state.currentPicks[conf] = winner.name;
      const playerId = CONFIG.DRAFT_ORDER[state.currentPlayerIndex];
      
      if (conf === 'afc') {
        state.picks[playerId].afcTeam = winner.name;
        state.availableAFC = state.availableAFC.filter(t => t.name !== winner.name);
      } else {
        state.picks[playerId].nfcTeam = winner.name;
        state.availableNFC = state.availableNFC.filter(t => t.name !== winner.name);
      }
      
      state.replayData.push({ playerId, conference: conf, team: winner.name, timestamp: Date.now() });
      showWinner(winner, conf);
      btn.classList.add('picked');
      btn.textContent = `‚úì ${winner.short}`;
      saveDraftData();
      renderDraftBoard();
      state.isSpinning = false;
      updateButtonStates();
    }

    function showWinner(winner, conf) {
      const display = document.getElementById('winnerDisplay');
      const title = document.getElementById('winnerTitle');
      const team = document.getElementById('winnerTeam');
      const player = CONFIG.PLAYERS[CONFIG.DRAFT_ORDER[state.currentPlayerIndex]];
      title.textContent = `üéâ ${player.name} gets ${conf.toUpperCase()}:`;
      team.innerHTML = `<img src="${winner.logo}" alt="${winner.name}"><span>${winner.name}</span>`;
      display.classList.add('show');
      setTimeout(() => display.classList.remove('show'), 3000);
    }

    function updateButtonStates() {
      const afcBtn = document.getElementById('afcSpinBtn');
      const nfcBtn = document.getElementById('nfcSpinBtn');
      const nextBtn = document.getElementById('nextPlayerBtn');
      if (!state.currentPicks.afc && !state.isSpinning) afcBtn.disabled = false;
      if (!state.currentPicks.nfc && !state.isSpinning) nfcBtn.disabled = false;
      if (state.currentPicks.afc && state.currentPicks.nfc) nextBtn.classList.add('show');
    }

    function nextPlayer() {
      state.currentPlayerIndex++;
      if (state.currentPlayerIndex >= CONFIG.DRAFT_ORDER.length) {
        state.draftComplete = true;
        saveDraftData();
        updateUI();
        return;
      }
      state.currentPicks = { afc: null, nfc: null };
      const afcBtn = document.getElementById('afcSpinBtn');
      const nfcBtn = document.getElementById('nfcSpinBtn');
      const nextBtn = document.getElementById('nextPlayerBtn');
      afcBtn.disabled = false; afcBtn.classList.remove('picked'); afcBtn.textContent = 'üé∞ Spin AFC';
      nfcBtn.disabled = false; nfcBtn.classList.remove('picked'); nfcBtn.textContent = 'üé∞ Spin NFC';
      nextBtn.classList.remove('show');
      renderReels();
      updateUI();
      saveDraftData();
    }

    function updateUI() {
      if (state.draftComplete) {
        document.getElementById('currentPlayer').style.display = 'none';
        document.getElementById('slotMachine').style.display = 'none';
        document.getElementById('draftComplete').classList.add('show');
        return;
      }
      const playerId = CONFIG.DRAFT_ORDER[state.currentPlayerIndex];
      const player = CONFIG.PLAYERS[playerId];
      document.getElementById('currentPlayerAvatar').src = player.avatar;
      document.getElementById('currentPlayerText').textContent = player.name;
      
      const afcBtn = document.getElementById('afcSpinBtn');
      const nfcBtn = document.getElementById('nfcSpinBtn');
      const nextBtn = document.getElementById('nextPlayerBtn');
      
      if (state.currentPicks.afc) {
        afcBtn.disabled = true; afcBtn.classList.add('picked');
        const team = CONFIG.AFC_TEAMS.find(t => t.name === state.currentPicks.afc);
        afcBtn.textContent = `‚úì ${team?.short || 'Picked'}`;
      }
      if (state.currentPicks.nfc) {
        nfcBtn.disabled = true; nfcBtn.classList.add('picked');
        const team = CONFIG.NFC_TEAMS.find(t => t.name === state.currentPicks.nfc);
        nfcBtn.textContent = `‚úì ${team?.short || 'Picked'}`;
      }
      if (state.currentPicks.afc && state.currentPicks.nfc) nextBtn.classList.add('show');
    }

    function setMode(mode) {
      state.mode = mode;
      document.getElementById('liveModeBtn').classList.toggle('active', mode === 'live');
      document.getElementById('replayModeBtn').classList.toggle('active', mode === 'replay');
      document.getElementById('liveDraftSection').style.display = mode === 'live' ? 'block' : 'none';
      document.getElementById('resultsSection').style.display = mode === 'replay' ? 'block' : 'none';
    }

    function renderDraftBoard() {
      const grid = document.getElementById('draftGrid');
      grid.innerHTML = '';
      CONFIG.DRAFT_ORDER.forEach((playerId, index) => {
        const player = CONFIG.PLAYERS[playerId];
        const pick = state.picks[playerId];
        const isCurrent = index === state.currentPlayerIndex && !state.draftComplete;
        const isComplete = pick.afcTeam && pick.nfcTeam;
        const afcTeam = CONFIG.AFC_TEAMS.find(t => t.name === pick.afcTeam);
        const nfcTeam = CONFIG.NFC_TEAMS.find(t => t.name === pick.nfcTeam);
        
        const card = document.createElement('div');
        card.className = `draft-card ${isCurrent ? 'current' : ''} ${isComplete ? 'completed' : ''}`;
        card.innerHTML = `
          <img src="${player.avatar}" alt="${player.name}" class="draft-card-avatar">
          <div class="draft-card-info">
            <div class="draft-card-name">${player.name}</div>
            <div class="draft-card-picks">
              <div class="draft-pick afc ${!pick.afcTeam ? 'pending' : ''}">
                ${pick.afcTeam ? `<img src="${afcTeam?.logo}" alt="">${afcTeam?.short}` : 'AFC: TBD'}
              </div>
              <div class="draft-pick nfc ${!pick.nfcTeam ? 'pending' : ''}">
                ${pick.nfcTeam ? `<img src="${nfcTeam?.logo}" alt="">${nfcTeam?.short}` : 'NFC: TBD'}
              </div>
            </div>
          </div>
        `;
        grid.appendChild(card);
      });
    }

    function exportResults() {
      let text = 'üèà SUPER BOWL LX DRAFT RESULTS üèà\n\n';
      CONFIG.DRAFT_ORDER.forEach(id => {
        const player = CONFIG.PLAYERS[id];
        const pick = state.picks[id];
        text += `${player.name}:\n  AFC: ${pick.afcTeam || 'TBD'}\n  NFC: ${pick.nfcTeam || 'TBD'}\n\n`;
      });
      navigator.clipboard.writeText(text).then(() => alert('Results copied to clipboard!'));
    }

    function exportToPicksJson() {
      const picksJson = {};
      CONFIG.DRAFT_ORDER.forEach(id => {
        const pick = state.picks[id];
        picksJson[id] = { afcTeam: pick.afcTeam || 'TBC', nfcTeam: pick.nfcTeam || 'TBC' };
      });
      navigator.clipboard.writeText(JSON.stringify(picksJson, null, 2)).then(() => alert('picks.json copied!'));
    }

    function showLoading(show) { document.getElementById('loadingOverlay').classList.toggle('show', show); }

    document.addEventListener('DOMContentLoaded', init);
  </script>
  
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js').then(() => console.log('‚úÖ SW registered'));
    }
  </script>
</body>
</html>
