<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üé∞ Super Bowl LX Draft Spinner</title>
  
  <!-- PWA Support -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#1a1a2e">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="SB Draft">
  <link rel="apple-touch-icon" href="icons/icon-192.png">
  
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Oswald:wght@400;500;600;700&family=Roboto+Condensed:wght@400;700&display=swap');
    
    :root {
      --bg-dark: #0a0a0f;
      --bg-card: #12121a;
      --bg-lighter: #1a1a24;
      --gold: #d4af37;
      --gold-light: #f4d03f;
      --gold-dark: #b8960b;
      --red: #c41e3a;
      --red-dark: #8b0000;
      --green: #2ecc71;
      --blue: #3498db;
      --text: #ffffff;
      --text-muted: #8a8a9a;
      --border: #2a2a3a;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Roboto Condensed', sans-serif;
      background: var(--bg-dark);
      color: var(--text);
      min-height: 100vh;
      overflow-x: hidden;
    }
    
    /* Header */
    .header {
      text-align: center;
      padding: 20px;
      background: linear-gradient(180deg, rgba(196,30,58,0.3) 0%, transparent 100%);
    }
    
    .header h1 {
      font-family: 'Oswald', sans-serif;
      font-size: 2rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 3px;
      background: linear-gradient(135deg, var(--gold), var(--gold-light), var(--gold));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .header p {
      color: var(--text-muted);
      font-size: 0.9rem;
      margin-top: 4px;
    }
    
    /* Main Container */
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    
    /* Mode Selector */
    .mode-selector {
      display: flex;
      justify-content: center;
      gap: 12px;
      margin-bottom: 24px;
    }
    
    .mode-btn {
      padding: 12px 24px;
      border: 2px solid var(--border);
      border-radius: 12px;
      background: var(--bg-card);
      color: var(--text);
      font-family: 'Oswald', sans-serif;
      font-size: 1rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .mode-btn:hover {
      border-color: var(--gold);
    }
    
    .mode-btn.active {
      background: linear-gradient(135deg, var(--gold), var(--gold-dark));
      color: var(--bg-dark);
      border-color: var(--gold);
    }
    
    /* Draft Status */
    .draft-status {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 24px;
      text-align: center;
    }
    
    .current-pick {
      font-family: 'Oswald', sans-serif;
      font-size: 1.5rem;
      color: var(--gold);
      margin-bottom: 8px;
    }
    
    .pick-details {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 16px;
      flex-wrap: wrap;
    }
    
    .player-badge {
      display: flex;
      align-items: center;
      gap: 8px;
      background: var(--bg-lighter);
      padding: 8px 16px;
      border-radius: 20px;
    }
    
    .player-badge img {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      object-fit: cover;
    }
    
    .player-badge span {
      font-weight: 600;
    }
    
    .conference-badge {
      padding: 8px 16px;
      border-radius: 20px;
      font-family: 'Oswald', sans-serif;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    .conference-badge.afc {
      background: linear-gradient(135deg, #c41e3a, #8b0000);
      color: white;
    }
    
    .conference-badge.nfc {
      background: linear-gradient(135deg, #1e56a0, #163d6b);
      color: white;
    }
    
    /* Spinner Container */
    .spinner-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-bottom: 24px;
    }
    
    .wheel-wrapper {
      position: relative;
      width: 320px;
      height: 320px;
      margin-bottom: 20px;
    }
    
    @media (min-width: 640px) {
      .wheel-wrapper {
        width: 400px;
        height: 400px;
      }
    }
    
    .wheel {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      position: relative;
      transition: transform 5s cubic-bezier(0.17, 0.67, 0.12, 0.99);
      box-shadow: 
        0 0 0 8px var(--gold),
        0 0 0 12px var(--bg-dark),
        0 0 40px rgba(212, 175, 55, 0.3);
      overflow: hidden;
    }
    
    /* Wheel segments using conic-gradient */
    .wheel-bg {
      position: absolute;
      width: 100%;
      height: 100%;
      border-radius: 50%;
    }
    
    /* Team labels positioned around the wheel */
    .wheel-label {
      position: absolute;
      left: 50%;
      top: 50%;
      display: flex;
      flex-direction: column;
      align-items: center;
      transform-origin: center center;
      pointer-events: none;
    }
    
    .wheel-label img {
      width: 36px;
      height: 36px;
      object-fit: contain;
    }
    
    @media (min-width: 640px) {
      .wheel-label img {
        width: 44px;
        height: 44px;
      }
    }
    
    .wheel-label span {
      font-family: 'Oswald', sans-serif;
      font-size: 0.6rem;
      font-weight: 600;
      color: white;
      text-shadow: 1px 1px 3px rgba(0,0,0,0.9);
      margin-top: 2px;
    }
    
    @media (min-width: 640px) {
      .wheel-label span {
        font-size: 0.7rem;
      }
    }
    
    /* Pointer */
    .wheel-pointer {
      position: absolute;
      top: -15px;
      left: 50%;
      transform: translateX(-50%);
      width: 0;
      height: 0;
      border-left: 20px solid transparent;
      border-right: 20px solid transparent;
      border-top: 40px solid var(--gold);
      filter: drop-shadow(0 4px 8px rgba(0,0,0,0.5));
      z-index: 10;
    }
    
    .wheel-pointer::after {
      content: '';
      position: absolute;
      top: -38px;
      left: -15px;
      width: 0;
      height: 0;
      border-left: 15px solid transparent;
      border-right: 15px solid transparent;
      border-top: 30px solid var(--gold-light);
    }
    
    /* Center circle */
    .wheel-center {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 70px;
      height: 70px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--bg-card), var(--bg-dark));
      border: 4px solid var(--gold);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 5;
      box-shadow: 0 4px 20px rgba(0,0,0,0.5);
    }
    
    .wheel-center img {
      width: 45px;
      height: 45px;
      object-fit: contain;
    }
    
    /* Spin Button */
    .spin-btn {
      padding: 16px 48px;
      border: none;
      border-radius: 12px;
      background: linear-gradient(135deg, var(--gold), var(--gold-dark));
      color: var(--bg-dark);
      font-family: 'Oswald', sans-serif;
      font-size: 1.3rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 2px;
      cursor: pointer;
      transition: all 0.2s;
      box-shadow: 0 4px 20px rgba(212, 175, 55, 0.4);
    }
    
    .spin-btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 6px 30px rgba(212, 175, 55, 0.5);
    }
    
    .spin-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }
    
    .spin-btn.spinning {
      animation: pulse 0.5s infinite;
    }
    
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.02); }
    }
    
    /* Result Display */
    .result-display {
      display: none;
      text-align: center;
      padding: 24px;
      background: var(--bg-card);
      border: 2px solid var(--gold);
      border-radius: 16px;
      margin-bottom: 24px;
      animation: resultPop 0.5s ease;
    }
    
    .result-display.show {
      display: block;
    }
    
    @keyframes resultPop {
      0% { transform: scale(0.8); opacity: 0; }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); opacity: 1; }
    }
    
    .result-display h3 {
      font-family: 'Oswald', sans-serif;
      font-size: 1.5rem;
      color: var(--gold);
      margin-bottom: 12px;
    }
    
    .result-team {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
    }
    
    .result-team img {
      width: 64px;
      height: 64px;
      object-fit: contain;
    }
    
    .result-team span {
      font-family: 'Oswald', sans-serif;
      font-size: 1.8rem;
      font-weight: 700;
    }
    
    /* Draft Board */
    .draft-board {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 24px;
    }
    
    .draft-board h2 {
      font-family: 'Oswald', sans-serif;
      font-size: 1.3rem;
      color: var(--gold);
      margin-bottom: 16px;
      text-align: center;
    }
    
    .draft-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 12px;
    }
    
    @media (min-width: 640px) {
      .draft-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }
    
    .draft-card {
      background: var(--bg-lighter);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 12px;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .draft-card.current {
      border-color: var(--gold);
      box-shadow: 0 0 20px rgba(212, 175, 55, 0.2);
    }
    
    .draft-card.completed {
      opacity: 0.7;
    }
    
    .draft-card-avatar {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid var(--border);
    }
    
    .draft-card.current .draft-card-avatar {
      border-color: var(--gold);
    }
    
    .draft-card-info {
      flex: 1;
    }
    
    .draft-card-name {
      font-family: 'Oswald', sans-serif;
      font-size: 1.1rem;
      font-weight: 600;
    }
    
    .draft-card-picks {
      display: flex;
      gap: 8px;
      margin-top: 4px;
    }
    
    .draft-pick {
      display: flex;
      align-items: center;
      gap: 4px;
      font-size: 0.75rem;
      padding: 2px 8px;
      border-radius: 10px;
      background: var(--bg-dark);
    }
    
    .draft-pick img {
      width: 16px;
      height: 16px;
      object-fit: contain;
    }
    
    .draft-pick.afc {
      border: 1px solid #c41e3a;
    }
    
    .draft-pick.nfc {
      border: 1px solid #1e56a0;
    }
    
    .draft-pick.pending {
      color: var(--text-muted);
      font-style: italic;
    }
    
    /* Replay Controls */
    .replay-controls {
      display: none;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 24px;
      text-align: center;
    }
    
    .replay-controls.show {
      display: block;
    }
    
    .replay-controls h3 {
      font-family: 'Oswald', sans-serif;
      color: var(--gold);
      margin-bottom: 12px;
    }
    
    .replay-btn {
      padding: 12px 24px;
      border: 2px solid var(--gold);
      border-radius: 12px;
      background: transparent;
      color: var(--gold);
      font-family: 'Oswald', sans-serif;
      font-size: 1rem;
      font-weight: 600;
      text-transform: uppercase;
      cursor: pointer;
      transition: all 0.2s;
      margin: 4px;
    }
    
    .replay-btn:hover {
      background: var(--gold);
      color: var(--bg-dark);
    }
    
    /* Draft Complete */
    .draft-complete {
      display: none;
      text-align: center;
      padding: 40px;
      background: linear-gradient(135deg, rgba(212,175,55,0.1), rgba(212,175,55,0.05));
      border: 2px solid var(--gold);
      border-radius: 16px;
      margin-bottom: 24px;
    }
    
    .draft-complete.show {
      display: block;
    }
    
    .draft-complete h2 {
      font-family: 'Oswald', sans-serif;
      font-size: 2rem;
      color: var(--gold);
      margin-bottom: 16px;
    }
    
    .draft-complete p {
      color: var(--text-muted);
      margin-bottom: 20px;
    }
    
    .export-btn {
      padding: 12px 24px;
      border: none;
      border-radius: 12px;
      background: var(--green);
      color: white;
      font-family: 'Oswald', sans-serif;
      font-size: 1rem;
      font-weight: 600;
      text-transform: uppercase;
      cursor: pointer;
      margin: 4px;
    }
    
    /* Loading Overlay */
    .loading-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.8);
      z-index: 100;
      align-items: center;
      justify-content: center;
      flex-direction: column;
    }
    
    .loading-overlay.show {
      display: flex;
    }
    
    .spinner {
      width: 50px;
      height: 50px;
      border: 4px solid var(--border);
      border-top-color: var(--gold);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .loading-text {
      margin-top: 16px;
      color: var(--text-muted);
    }
  </style>
</head>
<body>
  <!-- Loading Overlay -->
  <div class="loading-overlay" id="loadingOverlay">
    <div class="spinner"></div>
    <p class="loading-text">Loading draft data...</p>
  </div>

  <!-- Header -->
  <header class="header">
    <h1>üé∞ Super Bowl LX Draft</h1>
    <p>Spin to win your playoff teams!</p>
  </header>

  <main class="container">
    <!-- Mode Selector -->
    <div class="mode-selector">
      <button class="mode-btn active" id="liveModeBtn" onclick="setMode('live')">üéØ Live Draft</button>
      <button class="mode-btn" id="replayModeBtn" onclick="setMode('replay')">üìπ Watch Replay</button>
    </div>

    <!-- Live Draft Section -->
    <div id="liveDraftSection">
      <!-- Draft Status -->
      <div class="draft-status" id="draftStatus">
        <div class="current-pick" id="currentPickText">Loading...</div>
        <div class="pick-details" id="pickDetails"></div>
      </div>

      <!-- Spinner -->
      <div class="spinner-container" id="spinnerContainer">
        <div class="wheel-wrapper">
          <div class="wheel-pointer"></div>
          <div class="wheel" id="wheel">
            <div class="wheel-bg" id="wheelBg"></div>
          </div>
          <div class="wheel-center" id="wheelCenter">
            <img src="Assets/afc-logo.png" alt="Conference" id="conferenceIcon">
          </div>
        </div>
        <button class="spin-btn" id="spinBtn" onclick="spin()">üé∞ SPIN!</button>
      </div>

      <!-- Result Display -->
      <div class="result-display" id="resultDisplay">
        <h3 id="resultTitle">Result!</h3>
        <div class="result-team" id="resultTeam"></div>
      </div>

      <!-- Draft Complete -->
      <div class="draft-complete" id="draftComplete">
        <h2>üèÜ Draft Complete!</h2>
        <p>All teams have been assigned. Good luck in the playoffs!</p>
        <button class="export-btn" onclick="exportResults()">üìã Copy Results</button>
        <button class="export-btn" onclick="exportToPicksJson()">üíæ Export picks.json</button>
      </div>

      <!-- Draft Board -->
      <div class="draft-board">
        <h2>üìã Draft Board</h2>
        <div class="draft-grid" id="draftGrid"></div>
      </div>
    </div>

    <!-- Replay Section -->
    <div id="replaySection" style="display: none;">
      <div class="replay-controls show">
        <h3>üìπ Draft Replay</h3>
        <p style="color: var(--text-muted); margin-bottom: 16px;">Watch the complete draft unfold</p>
        <button class="replay-btn" id="startReplayBtn" onclick="startReplay()">‚ñ∂Ô∏è Play Full Replay</button>
        <button class="replay-btn" onclick="skipToResults()">‚è≠Ô∏è Skip to Results</button>
      </div>
      
      <!-- Replay Spinner -->
      <div class="spinner-container" id="replaySpinnerContainer" style="display: none;">
        <div class="wheel-wrapper">
          <div class="wheel-pointer"></div>
          <div class="wheel" id="replayWheel">
            <div class="wheel-bg" id="replayWheelBg"></div>
          </div>
          <div class="wheel-center">
            <img src="Assets/afc-logo.png" alt="Conference" id="replayConferenceIcon">
          </div>
        </div>
      </div>

      <div class="result-display" id="replayResultDisplay">
        <h3 id="replayResultTitle">Result!</h3>
        <div class="result-team" id="replayResultTeam"></div>
      </div>

      <!-- Replay Draft Board -->
      <div class="draft-board">
        <h2>üìã Draft Results</h2>
        <div class="draft-grid" id="replayDraftGrid"></div>
      </div>
    </div>
  </main>

  <script>
    // ============================================
    // CONFIGURATION
    // ============================================
    const CONFIG = {
      JSONBIN_BIN_ID: '695b078fd0ea881f4054b2a0',
      JSONBIN_API_KEY: '$2a$10$C7BY0Kl0u74gNn/kXO7xNuayWv493/f1jAxlHUmx3ENADQKDii61C',
      
      DRAFT_ORDER: ['joe', 'jarv', 'matt', 'mark', 'gaz', 'liam', 'ben'],
      
      PLAYERS: {
        joe:  { name: 'Joe',  avatar: 'Assets/joe.png' },
        jarv: { name: 'Jarv', avatar: 'Assets/jarv.png' },
        matt: { name: 'Matt', avatar: 'Assets/matt.png' },
        mark: { name: 'Mark', avatar: 'Assets/mark.png' },
        gaz:  { name: 'Gaz',  avatar: 'Assets/gaz.png' },
        liam: { name: 'Liam', avatar: 'Assets/liam.png' },
        ben:  { name: 'Ben',  avatar: 'Assets/ben.png' }
      },
      
      AFC_TEAMS: [],
      NFC_TEAMS: []
    };

    // Wheel colors
    const WHEEL_COLORS = [
      '#c41e3a', '#1e56a0', '#2d6a4f', '#9b2226', 
      '#3d5a80', '#4a7c59', '#ae2012'
    ];

    // ============================================
    // FETCH PLAYOFF TEAMS FROM ESPN
    // ============================================
    async function fetchPlayoffTeams() {
      try {
        const response = await fetch('https://site.api.espn.com/apis/v2/sports/football/nfl/standings?season=2025&type=3');
        if (!response.ok) throw new Error('ESPN fetch failed');
        
        const data = await response.json();
        const afcTeams = [];
        const nfcTeams = [];
        
        data.children?.forEach(conference => {
          const isAFC = conference.name.includes('American');
          conference.children?.forEach(division => {
            division.standings?.entries?.forEach(entry => {
              const team = entry.team;
              const playoffSeed = entry.stats?.find(s => s.name === 'playoffSeed')?.value;
              
              if (playoffSeed && playoffSeed <= 7) {
                const teamData = {
                  name: team.displayName,
                  short: team.shortDisplayName || team.abbreviation,
                  logo: team.logos?.[0]?.href || `https://a.espncdn.com/i/teamlogos/nfl/500/${team.abbreviation.toLowerCase()}.png`,
                  seed: playoffSeed
                };
                (isAFC ? afcTeams : nfcTeams).push(teamData);
              }
            });
          });
        });
        
        afcTeams.sort((a, b) => a.seed - b.seed);
        nfcTeams.sort((a, b) => a.seed - b.seed);
        
        CONFIG.AFC_TEAMS = afcTeams.slice(0, 7);
        CONFIG.NFC_TEAMS = nfcTeams.slice(0, 7);
        
        console.log('‚úÖ Loaded playoff teams from ESPN:', CONFIG.AFC_TEAMS.length, 'AFC,', CONFIG.NFC_TEAMS.length, 'NFC');
        
        if (CONFIG.AFC_TEAMS.length === 0 || CONFIG.NFC_TEAMS.length === 0) {
          throw new Error('No playoff teams found in ESPN data');
        }
      } catch (err) {
        console.log('Using fallback teams:', err.message);
        
        // 2025-26 NFL Season Playoff Teams (Super Bowl LX)
        CONFIG.AFC_TEAMS = [
          { name: 'Denver Broncos', short: 'Broncos', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/den.png', seed: 1 },
          { name: 'New England Patriots', short: 'Patriots', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/ne.png', seed: 2 },
          { name: 'Jacksonville Jaguars', short: 'Jaguars', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/jax.png', seed: 3 },
          { name: 'Pittsburgh Steelers', short: 'Steelers', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/pit.png', seed: 4 },
          { name: 'Houston Texans', short: 'Texans', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/hou.png', seed: 5 },
          { name: 'Buffalo Bills', short: 'Bills', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/buf.png', seed: 6 },
          { name: 'Los Angeles Chargers', short: 'Chargers', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/lac.png', seed: 7 }
        ];
        
        CONFIG.NFC_TEAMS = [
          { name: 'Seattle Seahawks', short: 'Seahawks', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/sea.png', seed: 1 },
          { name: 'Chicago Bears', short: 'Bears', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/chi.png', seed: 2 },
          { name: 'Philadelphia Eagles', short: 'Eagles', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/phi.png', seed: 3 },
          { name: 'Carolina Panthers', short: 'Panthers', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/car.png', seed: 4 },
          { name: 'Los Angeles Rams', short: 'Rams', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/lar.png', seed: 5 },
          { name: 'San Francisco 49ers', short: '49ers', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/sf.png', seed: 6 },
          { name: 'Green Bay Packers', short: 'Packers', logo: 'https://a.espncdn.com/i/teamlogos/nfl/500/gb.png', seed: 7 }
        ];
      }
    }

    // ============================================
    // STATE
    // ============================================
    let state = {
      mode: 'live',
      draftStarted: false,
      draftComplete: false,
      currentPlayerIndex: 0,
      currentConference: 'afc',
      availableAFC: [],
      availableNFC: [],
      picks: {},
      replayData: [],
      isSpinning: false
    };

    // ============================================
    // INITIALIZATION
    // ============================================
    async function init() {
      showLoading(true);
      
      await fetchPlayoffTeams();
      
      // Initialize state
      state.availableAFC = [...CONFIG.AFC_TEAMS];
      state.availableNFC = [...CONFIG.NFC_TEAMS];
      
      CONFIG.DRAFT_ORDER.forEach(playerId => {
        state.picks[playerId] = { afcTeam: null, nfcTeam: null };
      });
      
      await loadDraftData();
      
      renderDraftBoard();
      updateDraftStatus();
      renderWheel('wheel', 'wheelBg');
      
      showLoading(false);
    }

    // ============================================
    // DATA PERSISTENCE
    // ============================================
    async function loadDraftData() {
      try {
        const response = await fetch(`https://api.jsonbin.io/v3/b/${CONFIG.JSONBIN_BIN_ID}/latest`, {
          headers: { 'X-Access-Key': CONFIG.JSONBIN_API_KEY }
        });
        
        if (response.ok) {
          const data = await response.json();
          const record = data.record;
          
          if (record && record.picks) {
            CONFIG.DRAFT_ORDER.forEach(playerId => {
              if (record.picks[playerId]) {
                state.picks[playerId] = record.picks[playerId];
              }
            });
            state.replayData = record.replayData || [];
            state.draftStarted = record.draftStarted || false;
            state.draftComplete = record.draftComplete || false;
            
            reconstructAvailableTeams();
            findCurrentPosition();
          }
        }
      } catch (err) {
        console.log('No existing draft data:', err);
      }
    }

    async function saveDraftData() {
      try {
        await fetch(`https://api.jsonbin.io/v3/b/${CONFIG.JSONBIN_BIN_ID}`, {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json',
            'X-Access-Key': CONFIG.JSONBIN_API_KEY
          },
          body: JSON.stringify({
            picks: state.picks,
            replayData: state.replayData,
            draftStarted: state.draftStarted,
            draftComplete: state.draftComplete,
            lastUpdated: new Date().toISOString()
          })
        });
      } catch (err) {
        console.error('Error saving:', err);
      }
    }

    function reconstructAvailableTeams() {
      state.availableAFC = [...CONFIG.AFC_TEAMS];
      state.availableNFC = [...CONFIG.NFC_TEAMS];
      
      Object.values(state.picks).forEach(pick => {
        if (pick.afcTeam) {
          state.availableAFC = state.availableAFC.filter(t => t.name !== pick.afcTeam);
        }
        if (pick.nfcTeam) {
          state.availableNFC = state.availableNFC.filter(t => t.name !== pick.nfcTeam);
        }
      });
    }

    function findCurrentPosition() {
      for (let i = 0; i < CONFIG.DRAFT_ORDER.length; i++) {
        const playerId = CONFIG.DRAFT_ORDER[i];
        const pick = state.picks[playerId];
        
        if (!pick.afcTeam) {
          state.currentPlayerIndex = i;
          state.currentConference = 'afc';
          return;
        }
        if (!pick.nfcTeam) {
          state.currentPlayerIndex = i;
          state.currentConference = 'nfc';
          return;
        }
      }
      state.draftComplete = true;
    }

    // ============================================
    // WHEEL RENDERING - Using Conic Gradient
    // ============================================
    function renderWheel(wheelId, bgId) {
      const wheel = document.getElementById(wheelId);
      const wheelBg = document.getElementById(bgId);
      const teams = state.currentConference === 'afc' ? state.availableAFC : state.availableNFC;
      
      if (teams.length === 0) return;
      
      const segmentAngle = 360 / teams.length;
      
      // Build conic-gradient for wheel background
                        let gradient = 'conic-gradient(from -90deg, ';
      teams.forEach((team, i) => {
        const startAngle = i * segmentAngle;
        const endAngle = (i + 1) * segmentAngle;
        gradient += `${WHEEL_COLORS[i % WHEEL_COLORS.length]} ${startAngle}deg ${endAngle}deg`;
        if (i < teams.length - 1) gradient += ', ';
      });
      gradient += ')';
      
      wheelBg.style.background = gradient;
      
      // Remove old labels
      wheel.querySelectorAll('.wheel-label').forEach(el => el.remove());
      
      // Add team labels - positioned to match conic-gradient(from -90deg)
      const wheelSize = wheel.offsetWidth;
      const radius = wheelSize * 0.35;
      
      teams.forEach((team, i) => {
        // Conic gradient starts at -90deg (top) and goes clockwise
        // Segment i spans from (i * segmentAngle) to ((i+1) * segmentAngle)
        // Center of segment i is at (i * segmentAngle) + (segmentAngle / 2)
        // But since gradient starts at top (-90deg), we subtract 90 for positioning
        const segmentCenterDeg = (i * segmentAngle) + (segmentAngle / 2) - 90 - segmentAngle;
        const angleRad = (segmentCenterDeg * Math.PI) / 180;
        
        const x = Math.cos(angleRad) * radius;
        const y = Math.sin(angleRad) * radius;
        
        const label = document.createElement('div');
        label.className = 'wheel-label';
        label.style.left = `calc(50% + ${x}px)`;
        label.style.top = `calc(50% + ${y}px)`;
        // Rotate around the label's center to face outward
        const rotation = (i * segmentAngle) + (segmentAngle / 2);
        label.style.transform = `translate(-50%, -50%) rotate(${rotation}deg)`;
        label.innerHTML = `
          <img src="${team.logo}" alt="${team.short}" onerror="this.style.display='none'">
          <span>${team.short}</span>
        `;
        
        wheel.appendChild(label);
      });
      
      // Update center icon
      const iconId = wheelId === 'wheel' ? 'conferenceIcon' : 'replayConferenceIcon';
      document.getElementById(iconId).src = state.currentConference === 'afc' 
        ? 'Assets/afc-logo.png' 
        : 'Assets/nfc-logo.png';
    }

    // ============================================
    // DRAFT BOARD RENDERING
    // ============================================
    function renderDraftBoard() {
      const grid = document.getElementById('draftGrid');
      grid.innerHTML = '';
      
      CONFIG.DRAFT_ORDER.forEach((playerId, index) => {
        const player = CONFIG.PLAYERS[playerId];
        const pick = state.picks[playerId];
        const isCurrent = index === state.currentPlayerIndex && !state.draftComplete;
        const isComplete = pick.afcTeam && pick.nfcTeam;
        
        const card = document.createElement('div');
        card.className = `draft-card ${isCurrent ? 'current' : ''} ${isComplete ? 'completed' : ''}`;
        
        card.innerHTML = `
          <img src="${player.avatar}" alt="${player.name}" class="draft-card-avatar">
          <div class="draft-card-info">
            <div class="draft-card-name">${player.name}</div>
            <div class="draft-card-picks">
              <div class="draft-pick afc ${!pick.afcTeam ? 'pending' : ''}">
                ${pick.afcTeam ? `<img src="${getTeamLogo(pick.afcTeam, 'afc')}" alt="">${getTeamShort(pick.afcTeam, 'afc')}` : 'AFC: TBD'}
              </div>
              <div class="draft-pick nfc ${!pick.nfcTeam ? 'pending' : ''}">
                ${pick.nfcTeam ? `<img src="${getTeamLogo(pick.nfcTeam, 'nfc')}" alt="">${getTeamShort(pick.nfcTeam, 'nfc')}` : 'NFC: TBD'}
              </div>
            </div>
          </div>
        `;
        
        grid.appendChild(card);
      });
    }

    function updateDraftStatus() {
      const statusText = document.getElementById('currentPickText');
      const pickDetails = document.getElementById('pickDetails');
      const spinBtn = document.getElementById('spinBtn');
      
      if (state.draftComplete) {
        statusText.textContent = 'üèÜ Draft Complete!';
        pickDetails.innerHTML = '';
        spinBtn.style.display = 'none';
        document.getElementById('draftComplete').classList.add('show');
        document.getElementById('spinnerContainer').style.display = 'none';
        return;
      }
      
      if (!state.draftStarted) {
        statusText.textContent = 'Ready to Start Draft';
        pickDetails.innerHTML = '<p style="color: var(--text-muted);">Click the button below to begin!</p>';
        spinBtn.textContent = 'üöÄ START DRAFT';
        return;
      }
      
      const currentPlayer = CONFIG.PLAYERS[CONFIG.DRAFT_ORDER[state.currentPlayerIndex]];
      const conference = state.currentConference.toUpperCase();
      const pickNum = getPickNumber();
      
      statusText.textContent = `Pick ${pickNum} of 14`;
      pickDetails.innerHTML = `
        <div class="player-badge">
          <img src="${currentPlayer.avatar}" alt="${currentPlayer.name}">
          <span>${currentPlayer.name}</span>
        </div>
        <div class="conference-badge ${state.currentConference}">${conference} Pick</div>
      `;
      
      spinBtn.textContent = 'üé∞ SPIN!';
    }

    function getPickNumber() {
      let pickNum = 0;
      for (let i = 0; i < CONFIG.DRAFT_ORDER.length; i++) {
        const playerId = CONFIG.DRAFT_ORDER[i];
        if (state.picks[playerId].afcTeam) pickNum++;
        if (state.picks[playerId].nfcTeam) pickNum++;
        if (i === state.currentPlayerIndex) {
          if (state.currentConference === 'afc') break;
          pickNum++;
          break;
        }
      }
      return pickNum + 1;
    }

    function getTeamLogo(teamName, conference) {
      const teams = conference === 'afc' ? CONFIG.AFC_TEAMS : CONFIG.NFC_TEAMS;
      return teams.find(t => t.name === teamName)?.logo || '';
    }

    function getTeamShort(teamName, conference) {
      const teams = conference === 'afc' ? CONFIG.AFC_TEAMS : CONFIG.NFC_TEAMS;
      return teams.find(t => t.name === teamName)?.short || teamName;
    }

    // ============================================
    // SPIN LOGIC
    // ============================================
    function spin() {
      if (state.isSpinning) return;
      
      if (!state.draftStarted) {
        state.draftStarted = true;
        updateDraftStatus();
        renderWheel('wheel', 'wheelBg');
        saveDraftData();
        return;
      }
      
      state.isSpinning = true;
      const spinBtn = document.getElementById('spinBtn');
      spinBtn.disabled = true;
      spinBtn.classList.add('spinning');
      
      const teams = state.currentConference === 'afc' ? state.availableAFC : state.availableNFC;
      const segmentAngle = 360 / teams.length;
      
      // Random winner
      const winnerIndex = Math.floor(Math.random() * teams.length);
      const winner = teams[winnerIndex];
      
      // Calculate spin - pointer is at top (0deg), wheel rotates clockwise
      // We need the winning segment's center to end up at the top
      const baseRotations = 5 + Math.floor(Math.random() * 3);
      const winnerCenterAngle = (winnerIndex * segmentAngle) + (segmentAngle / 2);
      const totalDegrees = (baseRotations * 360) + (360 - winnerCenterAngle);
      
      // Apply spin
      const wheel = document.getElementById('wheel');
      wheel.style.transform = `rotate(${totalDegrees}deg)`;
      
      // Record for replay
      state.replayData.push({
        playerId: CONFIG.DRAFT_ORDER[state.currentPlayerIndex],
        conference: state.currentConference,
        team: winner.name,
        spinDegrees: totalDegrees,
        timestamp: Date.now()
      });
      
      // After spin completes
      setTimeout(() => {
        showResult(winner);
        recordPick(winner);
        
        spinBtn.disabled = false;
        spinBtn.classList.remove('spinning');
        state.isSpinning = false;
        
        advanceToNextPick();
        saveDraftData();
        renderDraftBoard();
        updateDraftStatus();
        
        // Reset wheel
        setTimeout(() => {
          wheel.style.transition = 'none';
          wheel.style.transform = 'rotate(0deg)';
          setTimeout(() => {
            wheel.style.transition = 'transform 5s cubic-bezier(0.17, 0.67, 0.12, 0.99)';
            renderWheel('wheel', 'wheelBg');
          }, 50);
        }, 1000);
        
      }, 5500);
    }

    function showResult(winner) {
      const resultDisplay = document.getElementById('resultDisplay');
      const resultTitle = document.getElementById('resultTitle');
      const resultTeam = document.getElementById('resultTeam');
      
      const currentPlayer = CONFIG.PLAYERS[CONFIG.DRAFT_ORDER[state.currentPlayerIndex]];
      
      resultTitle.textContent = `${currentPlayer.name} gets...`;
      resultTeam.innerHTML = `
        <img src="${winner.logo}" alt="${winner.name}" onerror="this.style.display='none'">
        <span>${winner.name}</span>
      `;
      
      resultDisplay.classList.add('show');
      setTimeout(() => resultDisplay.classList.remove('show'), 3000);
    }

    function recordPick(winner) {
      const playerId = CONFIG.DRAFT_ORDER[state.currentPlayerIndex];
      
      if (state.currentConference === 'afc') {
        state.picks[playerId].afcTeam = winner.name;
        state.availableAFC = state.availableAFC.filter(t => t.name !== winner.name);
      } else {
        state.picks[playerId].nfcTeam = winner.name;
        state.availableNFC = state.availableNFC.filter(t => t.name !== winner.name);
      }
    }

    function advanceToNextPick() {
      if (state.currentConference === 'afc') {
        state.currentConference = 'nfc';
      } else {
        state.currentConference = 'afc';
        state.currentPlayerIndex++;
        
        if (state.currentPlayerIndex >= CONFIG.DRAFT_ORDER.length) {
          state.draftComplete = true;
        }
      }
    }

    // ============================================
    // MODE SWITCHING
    // ============================================
    function setMode(mode) {
      state.mode = mode;
      
      document.getElementById('liveModeBtn').classList.toggle('active', mode === 'live');
      document.getElementById('replayModeBtn').classList.toggle('active', mode === 'replay');
      
      document.getElementById('liveDraftSection').style.display = mode === 'live' ? 'block' : 'none';
      document.getElementById('replaySection').style.display = mode === 'replay' ? 'block' : 'none';
      
      if (mode === 'replay') {
        renderReplayDraftBoard();
      }
    }

    // ============================================
    // REPLAY FUNCTIONS
    // ============================================
    function renderReplayDraftBoard() {
      const grid = document.getElementById('replayDraftGrid');
      grid.innerHTML = '';
      
      CONFIG.DRAFT_ORDER.forEach((playerId) => {
        const player = CONFIG.PLAYERS[playerId];
        
        const card = document.createElement('div');
        card.className = 'draft-card';
        card.id = `replay-card-${playerId}`;
        
        card.innerHTML = `
          <img src="${player.avatar}" alt="${player.name}" class="draft-card-avatar">
          <div class="draft-card-info">
            <div class="draft-card-name">${player.name}</div>
            <div class="draft-card-picks">
              <div class="draft-pick afc pending" id="replay-afc-${playerId}">AFC: TBD</div>
              <div class="draft-pick nfc pending" id="replay-nfc-${playerId}">NFC: TBD</div>
            </div>
          </div>
        `;
        
        grid.appendChild(card);
      });
    }

    async function startReplay() {
      if (state.replayData.length === 0) {
        alert('No replay data available!');
        return;
      }
      
      renderReplayDraftBoard();
      
      document.getElementById('startReplayBtn').disabled = true;
      document.getElementById('replaySpinnerContainer').style.display = 'flex';
      
      // Reset available teams for replay
      let replayAvailableAFC = [...CONFIG.AFC_TEAMS];
      let replayAvailableNFC = [...CONFIG.NFC_TEAMS];
      
      for (let i = 0; i < state.replayData.length; i++) {
        const spinData = state.replayData[i];
        
        // Update available teams for this spin
        const teams = spinData.conference === 'afc' ? replayAvailableAFC : replayAvailableNFC;
        
        await playReplaySpin(spinData, teams);
        updateReplayCard(spinData);
        
        // Remove picked team
        if (spinData.conference === 'afc') {
          replayAvailableAFC = replayAvailableAFC.filter(t => t.name !== spinData.team);
        } else {
          replayAvailableNFC = replayAvailableNFC.filter(t => t.name !== spinData.team);
        }
        
        if (i < state.replayData.length - 1) {
          await sleep(2000);
        }
      }
      
      document.getElementById('startReplayBtn').disabled = false;
      document.getElementById('replaySpinnerContainer').style.display = 'none';
    }

    function playReplaySpin(spinData, availableTeams) {
      return new Promise(resolve => {
        const wheel = document.getElementById('replayWheel');
        const wheelBg = document.getElementById('replayWheelBg');
        const conferenceIcon = document.getElementById('replayConferenceIcon');
        
        // Temporarily set state for rendering
        const originalConf = state.currentConference;
        const originalAFC = state.availableAFC;
        const originalNFC = state.availableNFC;
        
        state.currentConference = spinData.conference;
        if (spinData.conference === 'afc') {
          state.availableAFC = availableTeams;
        } else {
          state.availableNFC = availableTeams;
        }
        
        renderWheel('replayWheel', 'replayWheelBg');
        
        // Restore state
        state.currentConference = originalConf;
        state.availableAFC = originalAFC;
        state.availableNFC = originalNFC;
        
        conferenceIcon.src = spinData.conference === 'afc' ? 'Assets/afc-logo.png' : 'Assets/nfc-logo.png';
        
        wheel.style.transition = 'none';
        wheel.style.transform = 'rotate(0deg)';
        
        setTimeout(() => {
          wheel.style.transition = 'transform 5s cubic-bezier(0.17, 0.67, 0.12, 0.99)';
          wheel.style.transform = `rotate(${spinData.spinDegrees}deg)`;
          
          setTimeout(() => {
            showReplayResult(spinData);
            resolve();
          }, 5500);
        }, 100);
      });
    }

    function showReplayResult(spinData) {
      const resultDisplay = document.getElementById('replayResultDisplay');
      const resultTitle = document.getElementById('replayResultTitle');
      const resultTeam = document.getElementById('replayResultTeam');
      
      const player = CONFIG.PLAYERS[spinData.playerId];
      const teams = spinData.conference === 'afc' ? CONFIG.AFC_TEAMS : CONFIG.NFC_TEAMS;
      const team = teams.find(t => t.name === spinData.team);
      
      resultTitle.textContent = `${player.name} gets...`;
      resultTeam.innerHTML = `
        <img src="${team.logo}" alt="${team.name}" onerror="this.style.display='none'">
        <span>${team.name}</span>
      `;
      
      resultDisplay.classList.add('show');
      setTimeout(() => resultDisplay.classList.remove('show'), 2000);
    }

    function updateReplayCard(spinData) {
      const pickElement = document.getElementById(`replay-${spinData.conference}-${spinData.playerId}`);
      const teams = spinData.conference === 'afc' ? CONFIG.AFC_TEAMS : CONFIG.NFC_TEAMS;
      const team = teams.find(t => t.name === spinData.team);
      
      pickElement.classList.remove('pending');
      pickElement.innerHTML = `<img src="${team.logo}" alt="">${team.short}`;
    }

    function skipToResults() {
      CONFIG.DRAFT_ORDER.forEach(playerId => {
        const pick = state.picks[playerId];
        
        if (pick.afcTeam) {
          const afcEl = document.getElementById(`replay-afc-${playerId}`);
          const afcTeam = CONFIG.AFC_TEAMS.find(t => t.name === pick.afcTeam);
          if (afcEl && afcTeam) {
            afcEl.classList.remove('pending');
            afcEl.innerHTML = `<img src="${afcTeam.logo}" alt="">${afcTeam.short}`;
          }
        }
        
        if (pick.nfcTeam) {
          const nfcEl = document.getElementById(`replay-nfc-${playerId}`);
          const nfcTeam = CONFIG.NFC_TEAMS.find(t => t.name === pick.nfcTeam);
          if (nfcEl && nfcTeam) {
            nfcEl.classList.remove('pending');
            nfcEl.innerHTML = `<img src="${nfcTeam.logo}" alt="">${nfcTeam.short}`;
          }
        }
      });
    }

    // ============================================
    // EXPORT FUNCTIONS
    // ============================================
    function exportResults() {
      let text = 'üèà SUPER BOWL LX DRAFT RESULTS üèà\n\n';
      
      CONFIG.DRAFT_ORDER.forEach(playerId => {
        const player = CONFIG.PLAYERS[playerId];
        const pick = state.picks[playerId];
        text += `${player.name}:\n`;
        text += `  AFC: ${pick.afcTeam || 'TBD'}\n`;
        text += `  NFC: ${pick.nfcTeam || 'TBD'}\n\n`;
      });
      
      navigator.clipboard.writeText(text).then(() => alert('Results copied to clipboard!'));
    }

    function exportToPicksJson() {
      const picksJson = {};
      
      CONFIG.DRAFT_ORDER.forEach(playerId => {
        const pick = state.picks[playerId];
        picksJson[playerId] = {
          afcTeam: pick.afcTeam || 'TBC',
          nfcTeam: pick.nfcTeam || 'TBC'
        };
      });
      
      navigator.clipboard.writeText(JSON.stringify(picksJson, null, 2)).then(() => {
        alert('picks.json content copied to clipboard!');
      });
    }

    // ============================================
    // UTILITIES
    // ============================================
    function showLoading(show) {
      document.getElementById('loadingOverlay').classList.toggle('show', show);
    }

    function sleep(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }

    // ============================================
    // INIT
    // ============================================
    document.addEventListener('DOMContentLoaded', init);
  </script>
  
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js')
        .then(() => console.log('‚úÖ Service Worker registered'))
        .catch(err => console.log('Service Worker error:', err));
    }
  </script>
</body>
</html>
